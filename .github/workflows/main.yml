      - name: Install Android SDK commandlinetools
        run: |
          set -e
          export ANDROID_SDK_ROOT=$HOME/android-sdk
          mkdir -p $ANDROID_SDK_ROOT/cmdline-tools
          wget -q https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O /tmp/cmdline.zip
          unzip -q /tmp/cmdline.zip -d $ANDROID_SDK_ROOT/cmdline-tools

          # Handle different zip layouts: sometimes it extracts to cmdline-tools/cmdline-tools/...
          if [ -d "$ANDROID_SDK_ROOT/cmdline-tools/cmdline-tools" ]; then
            rm -rf $ANDROID_SDK_ROOT/cmdline-tools/latest || true
            mv $ANDROID_SDK_ROOT/cmdline-tools/cmdline-tools $ANDROID_SDK_ROOT/cmdline-tools/latest
          else
            mkdir -p $ANDROID_SDK_ROOT/cmdline-tools/latest
            mv $ANDROID_SDK_ROOT/cmdline-tools/* $ANDROID_SDK_ROOT/cmdline-tools/latest/ || true
          fi

          # Ensure platform-tools dir exists (will be populated by sdkmanager)
          mkdir -p $ANDROID_SDK_ROOT/platform-tools

          # Export PATH for the current shell so sdkmanager is available immediately
          export PATH="$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$ANDROID_SDK_ROOT/platform-tools:$PATH"

          # Quick check
          which sdkmanager || echo "sdkmanager not found in PATH yet"
          sdkmanager --version

          # Accept licenses and install required components
          yes | sdkmanager --sdk_root=${ANDROID_SDK_ROOT} --licenses
          sdkmanager --sdk_root=${ANDROID_SDK_ROOT} "platform-tools" "platforms;android-33" "build-tools;33.0.2"

          # Make paths available to following steps
          echo "ANDROID_SDK_ROOT=${ANDROID_SDK_ROOT}" >> $GITHUB_ENV
          echo "${ANDROID_SDK_ROOT}/cmdline-tools/latest/bin" >> $GITHUB_PATH
          echo "${ANDROID_SDK_ROOT}/platform-tools" >> $GITHUB_PATH
